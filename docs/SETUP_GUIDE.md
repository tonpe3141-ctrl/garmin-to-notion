# NotebookLM 連携セットアップガイド

GarminのランニングデータをNotebookLMやGeminiカスタムGemで利用するための、Googleドライブ連携設定手順です。
手順は少し多いですが、これを行えば自動的に知識ベースが更新されるようになります。

## 1. Google Cloud プロジェクトの準備
1.  [Google Cloud Console](https://console.cloud.google.com/) にアクセスします。
2.  画面左上のプロジェクト選択プルダウンから **「新しいプロジェクト」** を作成します（名前は `garmin-notebooklm` など任意）。
3.  作成したプロジェクトを選択した状態で、**「APIとサービス」 > 「有効なAPIとサービス」** を開きます。
4.  **「+ APIとサービスの有効化」** をクリックし、検索窓に `Google Drive API` と入力して有効化します。
5.  続けて、検索窓に **`Google Sheets API`** と入力し、こちらも **「有効にする」** をクリックします（これ重要！）。

## 2. サービスアカウント（ロボットユーザー）の作成
1.  同じく「APIとサービス」メニューから **「認証情報」** を選択します。
2.  画面上部の **「+ 認証情報を作成」** をクリックし、**「サービスアカウント」** を選択します。
3.  **サービスアカウント名** に任意の名前（例: `garmin-uploader`）を入力し、「作成して続行」をクリックします。
4.  **ロール** の選択では **「基本」 > 「編集者」** を選択し、「続行」→「完了」をクリックします。

## 3. 鍵（JSONファイル）の取得
1.  作成されたサービスアカウント（メールアドレスのようなID）が表示されている行をクリックします。
2.  上部タブの **「キー」** を選択します。
3.  **「鍵を追加」 > 「新しい鍵を作成」** をクリックします。
4.  キーのタイプで **「JSON」** を選択し、「作成」をクリックします。
5.  **JSONファイルがパソコンにダウンロードされます**。このファイルの中身（テキスト）を後で使います。

## 4. Googleドライブのフォルダ設定
1.  ご自身の [Googleドライブ](https://drive.google.com/) を開き、新しいフォルダを作成します（例: `Garmin Data`）。
2.  そのフォルダを右クリックし、**「共有」** を選択します。
3.  **「ユーザーやグループを追加」** の欄に、**先ほど作成したサービスアカウントのメールアドレス**を入力します。
4.  権限が **「編集者」** になっていることを確認し、「送信」をクリックします。
5.  **フォルダIDの確認**: フォルダを開いた状態で、URL末尾のランダムな文字列をコピーしておきます。

## 4.5. ファイルの準備（重要）
**今回は「Googleスプレッドシート」を使います。**

1.  Googleドライブの「Garmin Data」フォルダを開きます。
2.  **「新規」 > 「Google スプレッドシート」** を作成します。
3.  スプレッドシートのタイトルを **`Garmin Running Log`** に変更します。
4.  **重要**: 1行目にヘッダー（見出し）を手動で入力してください：
    *   A1: `Date`
    *   B1: `Type`
    *   C1: `Name`
    *   D1: `Distance (km)`
    *   E1: `Time (min)`
    *   F1: `Pace (/km)`
    *   G1: `Training Effect`
5.  これで準備完了です！プログラムが2行目以降にデータを追記・更新します。

## 5. GitHub Secretsの設定
1.  GitHubリポジトリの **Settings > Secrets and variables > Actions** を開きます。
2.  以下の2つのシークレットを追加します：

| Name | Value (入力する値) |
| :--- | :--- |
| **`GOOGLE_SERVICE_ACCOUNT_JSON`** | ダウンロードしたJSONファイルの**中身すべて**を貼り付けます |
| **`GOOGLE_DRIVE_FOLDER_ID`** | 手順4で確認した**フォルダID** |

## 6. プログラム構成（参考）
*   `src/Googleドライブ同期.py`: NotionのデータをGoogleスプレッドシートに同期する
*   `src/ガーミン活動データ取得.py`: Garminから最新データを取得する

## 7. 完了！
次回のGitHub Actions実行時（毎朝 8:30 JST、または手動実行）に、スプレッドシートが更新されます。

### NotebookLM / Gemini での使い方
*   **NotebookLM**: ソース追加画面で「Googleスライド/シート」を選択し、`Garmin Running Log` を選んでください。
*   **Gemini カスタムGem**: 知識ベースとしてGoogleドライブ上の同ファイルを選択してください。

これで、あなたのランニングデータに基づいたコーチングが可能になります！🏃
